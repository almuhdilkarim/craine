
function raptor_boots_post_prep() {

    if [[ -e /mnt/boot/amd-ucode.img ]]; then
        echo "clean microcode"
        mv /mnt/boot/amd-ucode.img /mnt/boot/kernel/ 
    fi

    if [[ -e /mnt/boot/intel-ucode.img ]]; then
        echo "clean microcode"
        mv /mnt/boot/intel-ucode.img /mnt/boot/kernel/ 
    fi

    if [[ -e /mnt/boot/vmlinuz-linux ]]; then
        echo "clean vmlinuz"
        kernel_type="vmlinuz-linux"
        mv /mnt/boot/vmlinuz-linux  /mnt/boot/kernel/ 
    fi

    if [[ -e /mnt/boot/vmlinuz-linux-zen ]]; then
        echo "clean vmlinuz"
        kernel_type="vmlinuz-linux-zen"
        mv /mnt/boot/vmlinuz-linux-zen  /mnt/boot/kernel/ 
    fi

    if [[ -e /mnt/boot/vmlinuz-linux-hardened ]]; then
        echo "clean vmlinuz"
        kernel_type="vmlinuz-linux-hardened"
        mv /mnt/boot/vmlinuz-linux-hardened  /mnt/boot/kernel/ 
    fi

    if [[ -e /mnt/boot/vmlinuz-linux-lqx ]]; then
        echo "clean vmlinuz"
        kernel_type="vmlinuz-linux-lqx"
        mv /mnt/boot/vmlinuz-linux-lqx  /mnt/boot/kernel/ 
    fi

    if [[ -e /mnt/boot/vmlinuz-linux-lts ]]; then
        echo "clean vmlinuz"
        kernel_type="vmlinuz-linux-lts"
        mv /mnt/boot/vmlinuz-linux-lts  /mnt/boot/kernel/ 
    fi

    echo "clean initramfs"
    test -e /mnt/boot/initramfs*  && rm -f /mnt/boot/initramfs*

    arch-chroot /mnt mkinitcpio -P
}

## secure boot @al muhdil karim <karim@yuros.org>, @muhmmad haydar kamil <kamil@yuros.org>, @sultan fajar ramadhan <sultan@yuros.org>
function raptor_boots_post_secu() {

    echo "setup secure boot"
    arch-chroot /mnt sbctl reset &&
    arch-chroot /mnt sbctl create-keys &&
   
    if [[ -n $uefipath == true ]];then
        arch-chroot /mnt sbctl enroll-keys -i -m
    else
        arch-chroot /mnt sbctl enroll-keys -i -f
    fi

    arch-chroot /mnt sbctl sign -s -o /usr/lib/systemd/boot/efi/systemd-bootx64.efi.signed /usr/lib/systemd/boot/efi/systemd-bootx64.efi
}

## boot loader @al muhdil karim <karim@yuros.org>, @achmad baihaqi <achmad@yuros.org>, @ibnu dzaky <dzaky@yuros.org>
function raptor_boots_post_boot() {
    echo "setup systemd boot"
    source /mnt/usr/lib/os-release
    echo "root=$rootpath" > /mnt/etc/cmdline.d/01-boot.conf && 
    bootctl --boot-path=/mnt/boot/ --esp-path=/mnt/boot/efi --efi-boot-option-description=$ID install
    echo "installation systemd boot"
}

function raptor_boots_post_srvc() {
    echo "enable boot service"
    arch-chroot /mnt systemctl enable systemd-boot-update.service
}

function raptor_boots_post() {
    sleep 2 && clear
    echo "Booting module configuration"
    raptor_boots_post_prep
    raptor_boots_post_secu
    raptor_boots_post_boot
    raptor_boots_post_srvc
}