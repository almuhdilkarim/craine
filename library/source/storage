#!/bin/bash

set -e


## PROC PARTITION
function craine_storage_part_root() {
    echo "create lvm root"
    sleep 2
}


function craine_storage_part_usrc() {
    echo "create lvm usrc"
    sleep 2
}


function craine_storage_part_flat() {
    echo "create lvm opts"
    sleep 2
}


function craine_storage_part_vars() {
    echo "create lvm vars"
    sleep 2
}


function craine_storage_part_vlog() {
    echo "create lvm vlog"
    sleep 2
}


function craine_storage_part_vaud() {
    echo "create lvm vaud"
    sleep 2
}


function craine_storage_part_vpac() {
    echo "create lvm vtmp"
    sleep 2
}


function craine_storage_part_vtmp() {
    echo "create lvm vtmp"
    sleep 2
}


function craine_storage_part_temp() {
    echo "create lvm temp"
    sleep 2
}


function craine_storage_part_swap() {
    echo "create lvm swap"
    sleep 2
}


function craine_storage_proc_pool() {
    craine_storage_part_root
    craine_storage_part_usrc
    craine_storage_part_flat
    craine_storage_part_vars
    craine_storage_part_vlog
    craine_storage_part_vaud
    craine_storage_part_vpac
    craine_storage_part_vtmp
    craine_storage_part_temp
    craine_storage_part_swap
}


function craine_storage_proc_llvm() {
    echo "start lvm proc with luks"
    craine_storage_proc_pool
}


function craine_storage_proc_lvmo() {
    echo "start lvm proc plain mode"
    craine_storage_proc_pool
}


function craine_storage_proc_plan() {
    echo "proc part plain mode"
}


function craine_storage_proc_swap() {

    if [[ $distro_llvm == true ]];then
        echo "swap on luks lvm"
    elif [[ $distro_proclvmo == true ]];then
        echo "swap on plain lvm"
    elif [[ $distro_procpath == true ]];then
        echo "swap on plan mode"
    fi
} 


function craine_storage_proc() {
    if [[ $distro_lukslv == true ]];then
        craine_storage_proc_llvm
    elif [[ $distro_planlv == true ]];then
        craine_storage_proc_lvmo
    elif [[ -n $distro_procpath ]];then
        craine_storage_proc_plan
    else
        echo "error : root partition its not spesified"
        exit 1
    fi
}



## BOOT PARTITION
function craine_storage_boot_vefi() {

    take_efipath=($(lsblk -o path,fstype | grep vfat | awk '{print $1}'))

    for item_efipath in "${take_efipath[@]}"; do

        echo "check efi partition at $item_efipath" 
        sudo mount $item_efipath /srv && sleep 2 && 
       
        if [[ -d "/srv/EFI/Microsoft" ]]; then
            winefipath="$item_efipath" && mkdir -p "$item_efipath/Linux" &&
            echo "check windows efi partition found at $item_efipath"
        fi

        sleep 1 && sudo umount -R /srv && sleep 2

    done
}


function craine_storage_boot_lefi() {
    echo "set efi at linux only partition" 
}


function craine_storage_boot_dual() {
    echo "set efi for dualboot partitions" 
}


function craine_storage_boot_llvm() {

    echo "boot part seperate mode"

    if [[ -n "$winefipath" ]]; then
        craine_storage_boot_dual
    else
        craine_storage_boot_lefi
    fi

}


function craine_storage_boot_lvmo() {

    echo "boot part seperate mode"

    if [[ -n "$winefipath" ]]; then
        craine_storage_boot_dual
    else
        craine_storage_boot_lefi
    fi

}


function craine_storage_boot_plan() {
    
    echo "boot part onrooter mode"

    if [[ -n "$winefipath" ]]; then
        craine_storage_boot_dual
    else
        craine_storage_boot_lefi
    fi
}


function craine_storage_boot() {
   
    craine_storage_boot_vefi

    if [[ $distro_lukslv == true ]];then
        craine_storage_boot_part
    elif [[ $distro_planlv == true ]];then
        craine_storage_boot_lvmo
    elif [[ -n $distro_datapath ]];then
        craine_storage_boot_plan
    else
        echo "error : boot path not spesified"
        exit 1
    fi
}



## DATA PARTITION
function craine_storage_part_http() {
    echo "create lvm http"
    sleep 2
}


function craine_storage_part_pods() {
    echo "create lvm pods"
    sleep 2
}


function craine_storage_part_dock() {
    echo "create lvm pods"
    sleep 2
}


function craine_storage_part_comp() {
    echo "create lvm compose data"
    sleep 2
}


function craine_storage_part_game() {
    echo "create lvm game"
    sleep 2
}


function craine_storage_data_llvm() {
    echo "start lvm data with luks"
    craine_storage_data_pool
}


function craine_storage_data_lvmo() {
    echo "start lvm home data mode"
    craine_storage_data_pool
}


function craine_storage_data_pool() {
    craine_storage_part_http
    craine_storage_part_pods
    craine_storage_part_dock
    craine_storage_part_game
}


function craine_storage_data_plan() {
    echo "start data plain mode"
}


function craine_storage_data() {

    if [[ $distro_lukslv == true ]];then
        craine_storage_data_llvm
    elif [[ $distro_planlv == true ]];then
        craine_storage_data_lvmo
    elif [[ -n $distro_datapath ]];then
        craine_storage_data_plan
    fi
}



## HOME PARTITION
function craine_storage_home_llvm() {
    echo "start lvm home with luks"
}


function craine_storage_home_lvmo() {
    echo "start lvm home plan mode"
}


function craine_storage_home_plan() {
    echo "start home plain mode"
}


function craine_storage_home() {

    if [[ $distro_lukslv == true  ]];then
        craine_storage_home_llvm
    elif [[ distro_planlv == true ]];then
        craine_storage_home_lvmo
    elif [[ -n $distro_homepath ]];then
        craine_storage_home_plan
    fi
}



## PACKAGE INSTALL
function craine_package_llvm() {

    if [[ $distro_lukslv == true  ]]||[[ distro_planlv == true ]];then
        pacstrap /mnt lvm2 btrfs
    fi   
}


## STORAGE INITIAL
function craine_storage() {
    craine_package_llvm
    craine_storage_proc
    craine_storage_boot
    craine_storage_home
    craine_storage_data
}